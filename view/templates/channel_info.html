<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8"/>
    <link rel="stylesheet" href="/static/css/index.css"/>
    <link rel="stylesheet" href="/static/css/global.css">
    <script src="/static/js/vue.js"></script>
    <script src="/static/js/layui-vue.js"></script>
    <script src="/static/js/axios.min.js"></script>
    <script src="/static/js/config.js"></script>

    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, minimal-ui">


</head>
<body>
<div id="app" style="padding: 10px 10px 10px 10px">
    <lay-field title="通道管理"></lay-field>

    <lay-space direction="vertical" :fill="true">
        <lay-space>
            <lay-button type="primary" @click="this.action.openInfoCreate=true">添加通道</lay-button>

        </lay-space>
        <lay-table :columns="infoTableOption.columns" :page="infoTableOption.page" :data-source="infoTableOption.data"
                   :loading="infoTableOption.loading" @change="changeInfoTable" id="id">

            <template v-slot:status="{ data }">
                <lay-switch v-model="data.status" onswitch-text="启用" :onswitch-value="10" unswitch-text="禁用"
                            :unswitch-value="20" @change="changeInfoStatus(data)"></lay-switch>
            </template>
            <template v-slot:channel-type="{ data }">
                {{getChannelTypeName(data)}}
            </template>

            <template v-slot:create-time="{ data }">
                {{this.$util.longTimeFormat(data.createTime)}}
            </template>

            <template v-slot:operator="{data}">
                <lay-button size="xs" type="warm" @click="editInfo(data)">编辑</lay-button>
                <lay-button size="xs" type="danger" @click="deleteInfo(data)">删除</lay-button>

            </template>

            <template v-slot:expand="{ data }">

                <lay-panel>
                    <lay-space v-if="data.channelType===10">
                        <span>webhook 类型：{{getWebhookTypeName(JSON.parse(data.optionJsonStr).hookType)}}</span>

                        <span>webhook url：{{JSON.parse(data.optionJsonStr).url}}</span>
                    </lay-space>
                    <lay-space v-if="data.channelType===20">
                        <span>host：{{JSON.parse(data.optionJsonStr).host}}</span>
                        <span>port：{{JSON.parse(data.optionJsonStr).port}}</span>
                        <span>username：{{JSON.parse(data.optionJsonStr).username}}</span>
                        <span>password：{{JSON.parse(data.optionJsonStr).password}}</span>
                        <span>toEmails：{{JSON.parse(data.optionJsonStr).toEmailListStr}}</span>
                    </lay-space>
                    <lay-space v-if="data.channelType===30">
                        <span>appId：{{JSON.parse(data.optionJsonStr).appId}}</span>
                        <span>appSecret：{{JSON.parse(data.optionJsonStr).appSecret}}</span>
                        <span>templateId：{{JSON.parse(data.optionJsonStr).templateId}}</span>
                        <span>userIds：{{JSON.parse(data.optionJsonStr).toUserListStr}}</span>

                    </lay-space>
                </lay-panel>


            </template>

        </lay-table>
    </lay-space>


    <!--    弹出层统一放置-->
    <div>
        <lay-layer title="修改通道" maxmin :shade="true" :shade-close="false" style="text-align: center;" area="60%"
                   resize move v-model="action.openInfoEdit">

            <lay-form :model="infoForm" v-if="action.openInfoEdit" ref="icf" initValidate
                      style="margin: 15px 15px 15px 15px">
                <lay-form-item label="通道名称：" prop="name" required
                               :rules="{min:2,max:20,message:'通道名称为5至20字'}">
                    <lay-input v-model="infoForm.name" prefix-icon="layui-icon-person" size="lg"></lay-input>
                </lay-form-item>

                <lay-form-item label="通道类型：">
                    <lay-select v-model="infoForm.channelType" disabled required>
                        <lay-select-option :value="10" label="webhook通道"></lay-select-option>
                        <lay-select-option :value="20" label="email通道"></lay-select-option>
                        <lay-select-option :value="30" label="公众号（测试号）通道"></lay-select-option>

                    </lay-select>
                </lay-form-item>

                <lay-form-item label="通道设置：">

                    <lay-form :model="webhookForm" v-if="infoForm.channelType==10" ref="wif">
                        <lay-form-item label="url：" prop="url" required
                                       :rules="{type:'url',message:'请输入正确的url格式'}">
                            <lay-input v-model="webhookForm.url" prefix-icon="layui-icon-person" size="lg"></lay-input>
                        </lay-form-item>

                        <lay-form-item label="类型：" prop="hookType" required>
                            <lay-select v-model="webhookForm.hookType">
                                <lay-select-option :value="11" label="钉钉"></lay-select-option>
                                <lay-select-option :value="12" label="飞书"></lay-select-option>
                                <lay-select-option :value="13" label="企业微信"></lay-select-option>

                            </lay-select>
                        </lay-form-item>
                    </lay-form>

                    <lay-form :model="emailForm" v-if="infoForm.channelType==20" ref="eif">
                        <lay-form-item label="host：" prop="host" required :rules="checkUrl">
                            <lay-input v-model="emailForm.host" prefix-icon="layui-icon-person" size="lg"></lay-input>
                        </lay-form-item>
                        <lay-form-item label="port：" prop="port" required :rules="{min:2,message:'请输入正确的端口号'}">
                            <lay-input v-model="emailForm.port" prefix-icon="layui-icon-person" size="lg"></lay-input>
                        </lay-form-item>
                        <lay-form-item label="用户名：" prop="username" required
                                       :rules="{type:'email',message:'请输入正确的email地址'}">
                            <lay-input v-model="emailForm.username" prefix-icon="layui-icon-person"
                                       size="lg"></lay-input>
                        </lay-form-item>
                        <lay-form-item label="密码：" prop="password" required>
                            <lay-input v-model="emailForm.password" prefix-icon="layui-icon-person"
                                       size="lg"></lay-input>
                        </lay-form-item>
                        <lay-form-item label="接收email：" prop="toEmailListStr" required :rules="checkToEmailListStr">
                            <lay-tag-input v-model="tagInputs.toEmailList"
                                           v-model:input-value="tagInputs.toEmailListInput"
                                           placeholder="输入正确的email地址敲击回车" @change="toEmailListStr"
                                           allow-clear></lay-tag-input>
                        </lay-form-item>

                    </lay-form>

                    <lay-form :model="wxMpForm" v-if="infoForm.channelType==30" ref="wif">
                        <lay-form-item label="appId：" prop="appId" required>
                            <lay-input v-model="wxMpForm.appId" prefix-icon="layui-icon-person" size="lg"></lay-input>
                        </lay-form-item>
                        <lay-form-item label="appSecret：" prop="appSecret" required>
                            <lay-input v-model="wxMpForm.appSecret" prefix-icon="layui-icon-person"
                                       size="lg"></lay-input>
                        </lay-form-item>
                        <lay-form-item label="templateId：" prop="templateId" required>
                            <lay-input v-model="wxMpForm.templateId" prefix-icon="layui-icon-person"
                                       size="lg"></lay-input>
                        </lay-form-item>
                        <lay-form-item label="接收人id：" prop="toUserListStr" required :rules="checkToUserListStr">
                            <lay-tag-input v-model="tagInputs.toUserList"
                                           v-model:input-value="tagInputs.toUserListInput"
                                           placeholder="输入正确的userId敲击回车" @change="toUserListStr"
                                           allow-clear></lay-tag-input>
                        </lay-form-item>

                    </lay-form>

                </lay-form-item>

                <lay-ripple>
                    <lay-button type="warm" @click="submitInfoUpdate">提交修改</lay-button>


                </lay-ripple>
            </lay-form>

        </lay-layer>

        <lay-layer title="新建通道" maxmin :shade="true" :shade-close="false" style="text-align: center;" area="60%"
                   resize move v-model="action.openInfoCreate">

            <lay-form :model="infoForm" v-if="action.openInfoCreate" ref="icf" initValidate
                      style="margin: 15px 15px 15px 15px">
                <lay-form-item label="通道名称：" prop="name" required
                               :rules="{min:2,max:20,message:'通道名称为5至20字'}">
                    <lay-input v-model="infoForm.name" prefix-icon="layui-icon-person" size="lg"></lay-input>
                </lay-form-item>


                <lay-form-item label="通道类型：">
                    <lay-select v-model="infoForm.channelType" required>
                        <lay-select-option :value="10" label="webhook通道"></lay-select-option>
                        <lay-select-option :value="20" label="email通道"></lay-select-option>
                        <lay-select-option :value="30" label="公众号（测试号）通道"></lay-select-option>

                    </lay-select>
                </lay-form-item>

                <lay-form-item label="通道设置：">

                    <lay-form :model="webhookForm" v-if="infoForm.channelType==10" ref="wif">
                        <lay-form-item label="url：" prop="url" required
                                       :rules="{type:'url',message:'请输入正确的url格式'}">
                            <lay-input v-model="webhookForm.url" prefix-icon="layui-icon-person" size="lg"></lay-input>
                        </lay-form-item>
                        <lay-form-item label="类型：" prop="hookType" required>
                            <lay-select v-model="webhookForm.hookType">
                                <lay-select-option :value="11" label="钉钉"></lay-select-option>
                                <lay-select-option :value="12" label="飞书"></lay-select-option>
                                <lay-select-option :value="13" label="企业微信"></lay-select-option>

                            </lay-select>
                        </lay-form-item>

                    </lay-form>

                    <lay-form :model="emailForm" v-if="infoForm.channelType==20" ref="eif">
                        <lay-form-item label="host：" prop="host" required :rules="checkUrl">
                            <lay-input v-model="emailForm.host" prefix-icon="layui-icon-person" size="lg"></lay-input>
                        </lay-form-item>
                        <lay-form-item label="port：" prop="port" required :rules="{min:2,message:'请输入正确的端口号'}">
                            <lay-input v-model="emailForm.port" prefix-icon="layui-icon-person" size="lg"></lay-input>
                        </lay-form-item>
                        <lay-form-item label="用户名：" prop="username" required
                                       :rules="{type:'email',message:'请输入正确的email地址'}">
                            <lay-input v-model="emailForm.username" prefix-icon="layui-icon-person"
                                       size="lg"></lay-input>
                        </lay-form-item>
                        <lay-form-item label="密码：" prop="password" required>
                            <lay-input v-model="emailForm.password" prefix-icon="layui-icon-person"
                                       size="lg"></lay-input>
                        </lay-form-item>
                        <lay-form-item label="接收email：" prop="toEmailListStr" required :rules="checkToEmailListStr">
                            <lay-tag-input v-model="tagInputs.toEmailList"
                                           v-model:input-value="tagInputs.toEmailListInput"
                                           placeholder="输入正确的email地址敲击回车" @change="toEmailListStr"
                                           allow-clear></lay-tag-input>
                        </lay-form-item>

                    </lay-form>

                    <lay-form :model="wxMpForm" v-if="infoForm.channelType==30" ref="wif">
                        <lay-form-item label="appId：" prop="appId" required>
                            <lay-input v-model="wxMpForm.appId" prefix-icon="layui-icon-person" size="lg"></lay-input>
                        </lay-form-item>
                        <lay-form-item label="appSecret：" prop="appSecret" required>
                            <lay-input v-model="wxMpForm.appSecret" prefix-icon="layui-icon-person"
                                       size="lg"></lay-input>
                        </lay-form-item>
                        <lay-form-item label="templateId：" prop="templateId" required>
                            <lay-input v-model="wxMpForm.templateId" prefix-icon="layui-icon-person"
                                       size="lg"></lay-input>
                        </lay-form-item>
                        <lay-form-item label="接收人id：" prop="toUserListStr" required :rules="checkToUserListStr">
                            <lay-tag-input v-model="tagInputs.toUserList"
                                           v-model:input-value="tagInputs.toUserListInput"
                                           placeholder="输入正确的userId敲击回车" @change="toUserListStr"
                                           allow-clear></lay-tag-input>
                        </lay-form-item>

                    </lay-form>

                </lay-form-item>

                <lay-ripple>
                    <lay-button type="warm" @click="submitInfoCreate">创建</lay-button>


                </lay-ripple>
            </lay-form>

        </lay-layer>

    </div>
</div>


<script type="module">

    const App = {
        data() {
            return {
                infoForm: {
                    id: null,
                    name: "",
                    channelType: 10,
                },
                tagInputs: {
                    toEmailList: [],
                    toEmailListInput: "",
                    toUserList: [],
                    toUserListInput: ""
                },
                webhookForm: {
                    url: "",
                    hookType: 11,
                },
                emailForm: {
                    host: "",
                    port: "",
                    username: "",
                    password: "",
                    toEmailListStr: ""
                },
                wxMpForm: {
                    appId: '',
                    appSecret: '',
                    templateId: "",
                    toUserListStr: ""
                },
                action: {
                    openInfoCreate: false,
                    openInfoEdit: false,
                },
                ds: [],
                infoTableOption: {
                    columns: [
                        {
                            title: "id",
                            width: "200px",
                            key: "id",
                            align: "center"
                        },
                        {
                            title: "通道名",
                            width: "200px",
                            key: "name",
                            align: "center"
                        },
                        {
                            title: "通道类型",
                            width: "200px",
                            customSlot: 'channel-type',
                            key: "channelType",
                            align: "center"
                        },

                        {
                            title: "创建时间",
                            width: "200px",
                            customSlot: 'create-time',
                            key: "createTime",
                            align: "center"
                        },
                        {
                            title: "操作",
                            width: "150px",
                            fixed: "right",
                            align: "center",
                            customSlot: "operator",
                            key: "operator"
                        }
                    ],
                    page: {
                        total: 0,
                        limit: 10,
                        current: 1,
                        showRefresh: true,
                    },
                    data: [],
                    searchValue: {},
                    loading: false
                },
                checkUrl: {
                    validator(rule, value, callback, source, options) {

                        let urlReg = /^([\w-]+\.)+[\w-]+(\/[\w-.\/?%&=]*)?$/
                        if (!urlReg.test(value)) {
                            callback(new Error(`host格式错误（请输入不带协议头的域名或ip）`));

                            return false
                        }
                        return true
                    }
                },
                checkToUserListStr: {
                    validator(rule, value, callback, source, options) {


                        if (value !== null && value !== "") {
                            const list = value.split(",")
                            for (let i = 0; i < list.length; i++) {
                                let item = list[i]
                                if (item === "") {
                                    callback(new Error(`userId不能为空`));
                                    return false
                                }
                            }


                        }

                        return true
                    }
                },

                checkToEmailListStr: {
                    validator(rule, value, callback, source, options) {


                        if (value !== null && value !== "") {
                            const list = value.split(",")
                            let emailRegx = /^\w+([-+.]\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*$/
                            for (let i = 0; i < list.length; i++) {
                                let item = list[i]
                                if (!emailRegx.test(item)) {
                                    callback(new Error(`${item}不是正确的email格式`));
                                    return false
                                }
                            }


                        }

                        return true
                    }
                },


            };
        },
        created() {
            this.loadInfoPage()
        },
        watch: {

            "action.openInfoCreate": {
                handler(next, _) {
                    //只监听新增框弹出状态的监听，当新增框关闭时 重置相应的form内容
                    if (!next) {
                        this.$refs[this.getFormRefsName(this.infoForm.channelType)].reset()
                        this.$refs.icf.reset()
                        this.infoForm.channelType = 10

                        this.tagInputs = this.$options.data().tagInputs

                    }

                }
            },
            "action.openInfoEdit": {
                handler(next, _) {
                    //只监听新增框弹出状态的监听，当新增框关闭时 重置相应的form内容
                    if (!next) {
                        this.$refs[this.getFormRefsName(this.infoForm.channelType)].reset()
                        this.$refs.icf.reset()
                        this.infoForm.channelType = 10

                        this.tagInputs = this.$options.data().tagInputs

                    }

                }
            }

        },
        methods: {
            toEmailListStr() {
                this.emailForm.toEmailListStr = this.$util.arrayParamToStr("", this.tagInputs.toEmailList)
            },
            toUserListStr() {
                this.wxMpForm.toUserListStr = this.$util.arrayParamToStr("", this.tagInputs.toUserList)
            },
            editInfo(data) {
                this.action.openInfoEdit = true

                this.infoForm = {
                    id: data.id,
                    name: data.name,
                    channelType: data.channelType,
                }



                let json = JSON.parse(data.optionJsonStr)
                switch (data.channelType) {
                    case 10:
                        this.webhookForm = {
                            url: json.url,
                            hookType: json.hookType
                        }
                        break
                    case 20:
                        this.emailForm = {
                            host: json.host,
                            port: json.port,
                            username: json.username,
                            password: json.password,
                        }
                        this.tagInputs.toEmailList = json.toEmailListStr.split(",")

                        this.emailForm.toEmailListStr = json.toEmailListStr
                        break
                    case 30:
                        this.wxMpForm = {
                            appId: json.appId,
                            appSecret: json.appSecret,
                            templateId: json.templateId,
                        }

                        this.tagInputs.toUserList = json.toUserListStr.split(",")

                        this.wxMpForm.toUserListStr = json.toUserListStr

                        break
                }

            },


            deleteInfo(data) {
                let index = LayuiVue.layer.confirm(`确认删除通道《${data.name}》吗？`, {
                    icon: 3,
                    title: false,
                    yes: () => {

                        let loadIndex = LayuiVue.layer.msg(`正在删除通道《${data.name}》`, {
                            icon: 16,
                            time: 0,
                            shade: true
                        })
                        this.$request.post("/api/admin/channel/info/del", {id: data.id}).then(res => {
                            if (res.code === 1) {

                                this.loadInfoPage()

                                LayuiVue.layer.close(index)
                                LayuiVue.layer.msg(`${res.msg},删除通道《${data.name}》成功`, {icon: 1, time: 1000})


                            } else {
                                LayuiVue.layer.msg(`${res.msg},删除通道《${data.name}》失败`, {icon: 2, time: 1000})

                            }
                        }).catch((res) => {
                            LayuiVue.layer.msg("网络错误，请稍后再试", {icon: 2, time: 1000})
                        }).finally(() => {

                            LayuiVue.layer.close(loadIndex)

                        })

                    }
                })
            },
            changeInfoStatus(data) {

                let lastStatus = data.status


                //判断当前值是否为禁用
                let ifDisabled = data.status === 20


                let loadIndex = LayuiVue.layer.msg(`正在${ifDisabled ? '启用' : '禁用'}通道《${data.name}》`, {
                    icon: 16,
                    time: 0,
                    shade: true
                })
                this.$request.post("/api/admin/channel/info/change_status",
                    {
                        id: data.id,
                        status: ifDisabled ? 10 : 20
                    }
                ).then(res => {
                    if (res.code === 1) {


                        LayuiVue.layer.msg(`${res.msg},${ifDisabled ? '启用' : '禁用'}通道《${data.name}》成功`, {
                            icon: 1,
                            time: 1000
                        })


                    } else {
                        data.status = lastStatus
                        LayuiVue.layer.msg(`${res.msg},${ifDisabled ? '启用' : '禁用'}通道《${data.name}》失败`, {
                            icon: 2,
                            time: 1000
                        })

                    }
                }).catch((res) => {
                    LayuiVue.layer.msg("网络错误，请稍后再试", {icon: 2, time: 1000})
                    data.status = lastStatus
                }).finally(() => {
                    LayuiVue.layer.close(loadIndex)

                })


            },
            RefreshKey(data) {


                let loadIndex = LayuiVue.layer.msg(`正在重置通道《${data.name}》的key`, {
                    icon: 16,
                    time: 0,
                    shade: true
                })
                this.$request.post("/api/admin/channel/info/refresh_key",
                    {
                        id: data.id,
                    }
                ).then(res => {
                    if (res.code === 1) {


                        LayuiVue.layer.msg(`重置通道《${data.name}》的key成功`, {
                            icon: 1,
                            time: 1000
                        })

                        data.key = res.data


                    } else {
                        LayuiVue.layer.msg(`重置通道《${data.name}》的key失败`, {
                            icon: 2,
                            time: 1000
                        })

                    }
                }).catch((res) => {
                    LayuiVue.layer.msg("网络错误，请稍后再试", {icon: 2, time: 1000})
                }).finally(() => {
                    LayuiVue.layer.close(loadIndex)

                })


            },
            changeInfoTable(data) {
                this.infoTableOption.page.current = data.current
                this.infoTableOption.page.limit = data.limit

                this.loadInfoPage()
            },
            loadInfoPageBegin() {
                this.infoTableOption.page = {
                    total: 0,
                    limit: 10,
                    current: 1,
                    showRefresh: true,
                }
                this.infoTableOption.searchValue = {}
                this.loadInfoPage()
            },
            loadInfoPage() {


                let param = {
                    page: this.infoTableOption.page.current,
                    limit: this.infoTableOption.page.limit,
                    params: {
                        ...this.infoTableOption.searchValue
                    }
                }
                this.infoTableOption.loading = true
                this.$request.post("/api/admin/channel/info/load", param).then(res => {
                    if (res.code == 1) {

                        this.infoTableOption.data = res.data
                        this.infoTableOption.page.total = res.count

                    } else {
                        LayuiVue.layer.msg(`${res.msg},加载通道信息失败`, {icon: 2, time: 1000})

                    }
                }).catch((res) => {
                    LayuiVue.layer.msg("网络错误，请稍后再试", {icon: 2, time: 1000})
                }).finally(() => {
                    this.infoTableOption.loading = false

                })

            },
            getChannelTypeName(data){
                switch (data.channelType) {
                    case 10:
                        let content = "webhook->"
                        let json = JSON.parse(data.optionJsonStr)

                        switch (json.hookType){
                            case 11:
                                content+="钉钉"
                                break
                            case 12:
                                content+="飞书"
                                break
                            case 13:
                                content+="企业微信"
                                break
                        }

                        return content
                    case 20:
                        return "email"
                    case 30:
                        return "公众号/测试号"
                }
            },
            getWebhookTypeName(type){
                switch (type) {
                    case 11:
                        return "钉钉"
                    case 12:
                        return "飞书"
                    case 13:
                        return "企业微信"
                }
            },
            getFormRefsName(type) {

                switch (type) {
                    case 10:
                        return "wif"
                    case 20:
                        return "eif"
                    case 30:
                        return "wif"
                }

            },
            getOptionValue(type) {

                switch (type) {
                    case 10:
                        return this.webhookForm
                    case 20:
                        return this.emailForm
                    case 30:
                        return this.wxMpForm
                }

            },
            submitInfoUpdate() {
                this.$refs.icf.validate((isValidate, model, errors) => {
                    if (!isValidate) {
                        return false
                    } else {
                        let type = this.infoForm.channelType
                        this.$refs[this.getFormRefsName(type)].validate((isValidate, model, errors) => {

                            if (!isValidate) {
                                return false
                            } else {
                                let option = this.getOptionValue(type)
                                let loadIndex = LayuiVue.layer.msg(`正在修改通道`, {
                                    icon: 16,
                                    time: 0,
                                    shade: true
                                })
                                this.$request.post("/api/admin/channel/info/update", {
                                    ...this.infoForm,
                                    optionJsonStr: JSON.stringify(option)
                                }).then(res => {
                                    if (res.code === 1) {

                                        LayuiVue.layer.msg("修改推送通道成功", {icon: 1, time: 1000,})
                                        this.action.openInfoEdit = false
                                        this.loadInfoPageBegin()


                                    } else {
                                        LayuiVue.layer.msg(`${res.msg},修改推送通道失败`, {icon: 2, time: 1000})

                                    }
                                }).catch((res) => {
                                    LayuiVue.layer.msg("网络错误，请稍后再试", {icon: 2, time: 1000})
                                }).finally(() => {
                                    LayuiVue.layer.close(loadIndex)
                                })

                            }
                        })

                        return false
                    }
                })

                return false


            },

            submitInfoCreate() {

                this.$refs.icf.validate((isValidate, model, errors) => {
                    if (!isValidate) {
                        return false
                    } else {
                        let type = this.infoForm.channelType
                        this.$refs[this.getFormRefsName(type)].validate((isValidate, model, errors) => {

                            if (!isValidate) {
                                return false
                            } else {
                                let option = this.getOptionValue(type)
                                let loadIndex = LayuiVue.layer.msg(`正在新建通道`, {
                                    icon: 16,
                                    time: 0,
                                    shade: true
                                })
                                this.$request.post("/api/admin/channel/info/create", {
                                    ...this.infoForm,
                                    optionJsonStr: JSON.stringify(option)
                                }).then(res => {
                                    if (res.code === 1) {

                                        LayuiVue.layer.msg("创建推送通道成功", {icon: 1, time: 1000,})
                                        this.action.openInfoCreate = false
                                        this.loadInfoPageBegin()


                                    } else {
                                        LayuiVue.layer.msg(`${res.msg},创建推送通道失败`, {icon: 2, time: 1000})

                                    }
                                }).catch((res) => {
                                    LayuiVue.layer.msg("网络错误，请稍后再试", {icon: 2, time: 1000})
                                }).finally(() => {
                                    LayuiVue.layer.close(loadIndex)

                                })
                            }
                        })

                        return false
                    }
                })

                return false


            },
        }
    };
    const app = Vue.createApp(App);


    app.use(LayuiVue);
    app.use(http)
    app.use(util)

    app.mount("#app");
</script>

<style>


</style>
</body>
</html>
